{"title":"Lesson 2: Data and File Management","markdown":{"yaml":{"title":"Lesson 2: Data and File Management","subtitle":"Adapted from parts of Mine Çetinkaya-Rundel's tidyverse course","author":"Nicky Wakim","title-slide-attributes":{"data-background-color":"#213c96"},"date":"`r library(here); source(here('class_dates.R')); w1d2`","format":{"revealjs":{"theme":"../simple_NW.scss","chalkboard":true,"slide-number":true,"show-slide-number":"all","width":1955,"height":1100,"footer":"Lesson 2: Data Management","highlight-style":"ayu"}}},"headingText":"R options","containsRefs":false,"markdown":"\n\n```{r setup, include = FALSE}\noptions(htmltools.dir.version = FALSE)\n\n# figure height, width, dpi\nknitr::opts_chunk$set(echo = TRUE, \n                      fig.width = 5, \n                      fig.height = 3,\n                      dpi = 300)\n\n# fontawesome\nhtmltools::tagList(rmarkdown::html_dependency_font_awesome())\n\n# magick\ndev.off <- function(){\n  invisible(grDevices::dev.off())\n}\n\n# set seed\nset.seed(1234)\n\n# packages\nlibrary(countdown)\nlibrary(tidyverse)\nlibrary(broom)\nlibrary(scales)\nlibrary(openintro)\nlibrary(jsonlite)\nlibrary(here)\n```\n\n## Need to include slides on working with and storing datasets\n\n- Raw/original\n- Processed/cleaned\n  - cleaned, handled missing values, transformed (pivoted), formatted properly, applying specific variable types from codebook\n- Feature engineered data\n  - creating new features or modifying existing ones\n\n# What we will cover\n\n1. Introduction to `tidyverse`\n2. `ggplot2` revisited\n2. Functions for data management\n3. Functions for data summarization\n4. Folder organization\n5. `here` package and importing data\n\n \n\n- Not covered: basic Quarto set up. Please see R recordings in OneDrive and my [EPI 525 site](https://nwakim.github.io/F24_EPI_525/schedule.html) for videos and slides.\n\n```{css, echo=FALSE}\n.reveal code {\n  max-height: 100% !important;\n}\n```\n\n## \n\n![Artwork by \\@allison_horst](../img_slides/debugging.png){fig-alt=\"A cartoon of a fuzzy round monster face showing 10 different emotions experienced during the process of debugging code. The progression goes from (1) “I got this” - looking determined and optimistic; (2) “Huh. Really thought that was it.” - looking a bit baffled; (3) “...” - looking up at the ceiling in thought; (4) “Fine. Restarting.” - looking a bit annoyed; (5) “OH WTF.” Looking very frazzled and frustrated; (6) “Zombie meltdown.” - looking like a full meltdown; (7) (blank) - sleeping; (8) “A NEW HOPE!” - a happy looking monster with a lightbulb above; (9) “insert awesome theme song” - looking determined and typing away; (10) “I love coding” - arms raised in victory with a big smile, with confetti falling.\"}\n\n# Introduction to the `tidyverse`\n\n## \n\n![](../img_slides/spiderverse.jpeg){fig-align=\"center\"}\n\n## What is the tidyverse?\n\nThe **tidyverse** is a collection of R packages designed for data science. All packages share an underlying design philosophy, grammar, and data structures.\n\n::: columns\n::: {.column width=\"45%\"}\n-   **ggplot2** - data visualisation\n-   **dplyr** - data manipulation\n-   **tidyr** - tidy data\n-   **readr** - read rectangular data\n-   **purrr** - functional programming\n-   **tibble** - modern data frames\n-   **stringr** - string manipulation\n-   **forcats** - factors\n-   and many more ...\n:::\n\n::: {.column width=\"55%\"}\n![](../img_slides/tidyverse.png){fig-align=\"center\" width=\"669\"}\n:::\n:::\n\n## Tidy data[^1]\n\n[^1]: Source: R for Data Science. Grolemund and Wickham.\n\n![](../img_slides/tidy-data-frame.png){fig-align=\"center\" width=\"1500\"}\n\n\n1.  Each variable must have its own column.\n\n2.  Each observation must have its own row.\n\n3.  Each value must have its own cell.\n\n## Pipe operator (`magrittr`)\n\n-   The pipe operator (`%>%`) allows us to step through sequential functions in the same way we follow if-then statements or steps from instructions\n\n \n\n::: heq\nI want to find my keys, then start my car, then drive to work, then park my car.\n:::\n\n \n\n::: columns\n::: {.column width=\"50%\"}\n**Nested**\n\n```{r eval = FALSE}\npark(drive(start_car(find(\"keys\")), \n           to = \"work\"))\n```\n:::\n\n::: {.column width=\"50%\"}\n**Piped**\n\n```{r eval = FALSE}\nfind(\"keys\") %>%\n  start_car() %>%\n  drive(to = \"work\") %>%\n  park()\n```\n:::\n:::\n\n## Recoding a binary variable with pipe operator\n\n \n\n::: heq\nLet's say I want a variable `transmission` to show the category names that are assigned to numeric values in the code. I want `0` to be coded as `automatic` and `1` to be coded as `manual`.\n:::\n\n \n\n::: columns\n::: {.column width=\"50%\"}\nBase R:\n\n```{r}\nmtcars$transmission <-\n  ifelse(\n    mtcars$am == 0,\n    \"automatic\",\n    \"manual\"\n  )\n```\n:::\n\n::: {.column width=\"50%\"}\nTidyverse:\n\n```{r}\nmtcars <- mtcars %>%\n  mutate(\n    transmission = case_when(\n      am == 0 ~ \"automatic\",\n      am == 1 ~ \"manual\"\n    )\n  )\n```\n\n \n\n::: hl\n`mutate()` creates new columns that are functions of existing variables\n:::\n:::\n:::\n\n## Recoding a multi-level variable\n\n \n\n::: heq\nLet's say I want a variable `gear` to show the category names that are assigned to numeric values in the code. I want `3` to be coded as gear `three`, `4` to be coded as gear `four`, `5` to be coded as gear `five`.\n:::\n\n \n\n::: columns\n::: {.column width=\"50%\"}\nBase R:\n\n```{r}\nmtcars$gear_char <-\n  ifelse(\n    mtcars$gear == 3,\n    \"three\",\n    ifelse(\n      mtcars$gear == 4,\n      \"four\",\n      \"five\"\n    )\n  )\n```\n:::\n\n::: {.column width=\"50%\"}\nTidyverse:\n\n```{r}\nmtcars <- mtcars %>%\n  mutate(\n    gear_char = case_when(\n      gear == 3 ~ \"three\",\n      gear == 4 ~ \"four\",\n      gear == 5 ~ \"five\"\n    )\n  )\n```\n:::\n:::\n\n# `ggplot2` revisited\n\n## `ggplot2` in tidyverse\n\n::: columns\n::: {.column width=\"50%\"}\n![](../img_slides/ggplot2-part-of-tidyverse.png){fig-align=\"center\" width=\"669\"}\n\n:::\n\n::: {.column width=\"50%\"}\n-   We talked about this in our review notes\n\n    -   I want to revisit it: always helps to have more examples!\n    -   This example is closer to the multivariable work we'll do in this class!\n\n \n\n-   **ggplot2** is tidyverse's data visualization package\n\n \n\n-   The `gg` in \"ggplot2\" stands for Grammar of Graphics\n\n \n\n-   It is inspired by the book **Grammar of Graphics** by Leland Wilkinson\n:::\n:::\n\n## Tidyverse: Visualizing multiple variables\n\n \n\n```{r out.width = \"100%\", fig.asp = 0.3, fig.width = 8}\nggplot(\n  mtcars,\n  aes(x = disp, y = mpg, color = transmission)) +\n  geom_point()\n```\n\n## Tidyverse: Visualizing even more variables\n\n```{r out.width = \"100%\", fig.asp = 0.3, fig.width = 8}\nggplot(\n  mtcars,\n  aes(x = disp, y = mpg, color = transmission)) +\n  geom_point() +\n  facet_wrap(~ cyl)\n```\n\n## Base R: Visualizing even more variables\n\n```{r out.width = \"100%\", fig.asp = 0.3, fig.width = 8}\nmtcars$trans_color <- ifelse(mtcars$transmission == \"automatic\", \"green\", \"blue\")\nmtcars_cyl4 = mtcars[mtcars$cyl == 4, ]\nmtcars_cyl6 = mtcars[mtcars$cyl == 6, ]\nmtcars_cyl8 = mtcars[mtcars$cyl == 8, ]\npar(mfrow = c(1, 3), mar = c(2.5, 2.5, 2, 0), mgp = c(1.5, 0.5, 0))\nplot(mpg ~ disp, data = mtcars_cyl4, col = trans_color, main = \"Cyl 4\")\nplot(mpg ~ disp, data = mtcars_cyl6, col = trans_color, main = \"Cyl 6\")\nplot(mpg ~ disp, data = mtcars_cyl8, col = trans_color, main = \"Cyl 8\")\nlegend(\"topright\", legend = c(\"automatic\", \"manual\"), pch = 1, col = c(\"green\", \"blue\"))\n```\n\n# Functions for data management\n\n## Important functions for data management\n\n \n\n**Data manipulation**\n\n-   `pivot_longer()` and `pivot_wider()` (not covered today)\n\n-   `rename()`\n\n-   `mutate()`\n\n-   `filter()`\n\n-   `select()`\n\n**Summarizing data**\n\n-   `tbl_summary()`\n-   `group_by()`\n-   `summarize()`\n-   `across()`\n\n## Let's look back at the `dds.discr` dataset that I briefly used last class\n\n   \n\n-   We will load the data (This is a special case! `dds.discr` is a built-in R dataset)\n\n```{r}\ndata(\"dds.discr\")\n```\n\n-   Now, let's take a glimpse at the dataset:\n\n```{r}\nglimpse(dds.discr)\n```\n\n## `rename()`: one of the first things I usually do\n\n-   I notice that two variables have values that don't necessarily match the variable name\n\n    -   Female and male are not genders\n\n    -   \"White not Hispanic\" combines race and ethnicity into one category\n\n::: heq\nI want to rename gender to SAB (sex assigned at birth) and rename ethnicity to R_E (race and ethnicity)\n:::\n\n \n\n```{r}\ndds.discr1 = dds.discr %>% \n  rename(SAB = gender, \n         R_E = ethnicity)\n\nglimpse(dds.discr1)\n```\n\n## `mutate()`: constructing new variables from what you have\n\n-   We've seen a couple examples for `mutate()` so far (mostly because its used so often!)\n\n-   We haven't seen an example where we make a new variable from two variables\n\n::: heq\nI want to make a variable that is the ratio of expenditures over age\n:::\n\n \n\n```{r}\ndds.discr2 = dds.discr1 %>%\n  mutate(exp_to_age = expenditures/age)\n\nglimpse(dds.discr2)\n```\n\n## `mutate()`: other examples\n\n```{r}\ndds.discr3 = dds.discr1 %>%\n  mutate(expend_20perc = expenditures * 0.2, \n         expend_sq = expenditures^2, \n         expend_over_5000 = case_when(\n           expenditures > 5000 ~ \"Yes\", \n           expenditures <= 5000 ~ \"No\"\n         ), \n         expend_log = log(expenditures)\n  )\nglimpse(dds.discr3)\n```\n\n## `filter()`: keep rows that match a condition\n\n-   What if I want to subset the data frame? (keep certain rows of observations)\n\n::: heq\nI want to look at the data for people who between 50 and 60 years old\n:::\n\n \n\n```{r}\ndds.discr3 = dds.discr2 %>%\n  filter(age >= 50 & age <= 60)\n\nglimpse(dds.discr3)\n```\n\n## `select()`: keep or drop columns using their names and types\n\n-   What if I want to remove or keep certain variables?\n\n::: heq\nI want to only have age and expenditure in my data frame\n:::\n\n \n\n```{r}\ndds.discr4 = dds.discr2 %>%\n  select(age, expenditures)\n\nglimpse(dds.discr4)\n```\n\n# Summarizing Data\n\n## `tbl_summary()` : table summary (1/2)\n\n-   What if I want one of those fancy summary tables that are at the top of most research articles? (lovingly called \"Table 1\")\n\n::: columns\n::: {.column width=\"50%\"}\n```{r}\n#| eval: false\n\nlibrary(gtsummary)\ntbl_summary(dds.discr2)\n```\n:::\n\n::: {.column width=\"50%\"}\n```{r}\n#| echo: false\n\nlibrary(gtsummary)\ntbl_summary(dds.discr2)\n```\n:::\n:::\n\n## `tbl_summary()` : table summary (2/2)\n\n-   Let's make this more presentable\n\n \n\n::: columns\n::: {.column width=\"70%\"}\n```{r}\n#| eval: false\n\ndds.discr2 %>%\n  select(-id, -age.cohort, -exp_to_age) %>%\n  tbl_summary(label = c(age ~ \"Age\", \n                        R_E ~ \"Race/Ethnicity\", \n                        SAB ~ \"Sex Assigned at Birth\", \n                        expenditures ~ \"Expenditures\") ,\n              statistic = list(all_continuous() ~ \"{mean} ({sd})\"))\n```\n:::\n\n::: {.column width=\"30%\"}\n```{r}\n#| echo: false\n\ndds.discr2 %>%\n  select(-id, -age.cohort, -exp_to_age) %>%\n  tbl_summary(label = c(age ~ \"Age\", \n                        R_E ~ \"Race/Ethnicity\", \n                        SAB ~ \"Sex Assigned at Birth\", \n                        expenditures ~ \"Expenditures\") ,\n              statistic = list(all_continuous() ~ \"{mean} ({sd})\"))\n```\n:::\n:::\n\n## `group_by()`: group by one or more variables\n\n-   What if I want to quickly look at group differences?\n-   It will not change how the data look, but changes the actions of following functions\n\n::: heq\nI want to group my data by sex assigned at birth.\n:::\n\n \n\n```{r}\ndds.discr5 = dds.discr2 %>%\n  group_by(SAB)\nglimpse(dds.discr5)\n```\n\n-   Let's see how the groups change something like the `summarize()` function in the next slide\n\n## `summarize()`: summarize your data or grouped data into one row\n\n-   What if I want to calculate specific descriptive statistics for my variables?\n-   This function is often best used with `group_by()`\n-   If only presenting the summaries, functions like `tbl_summary()` is better\n-   `summarize()` creates a new data frame, which means you can plot and manipulate the summarized data\n\n \n\n::: columns\n::: column\nOver whole sample:\n\n```{r}\ndds.discr2 %>% \n  summarize(\n    ave = mean(expenditures),\n    SD = sd(expenditures),\n    med = median(expenditures))\n```\n:::\n\n::: column\nGrouped by sex assigned at birth:\n\n```{r}\ndds.discr2 %>% \n  group_by(SAB) %>% \n  summarize(\n    ave = mean(expenditures),\n    SD = sd(expenditures),\n    med = median(expenditures))\n```\n:::\n:::\n\n## `across()`: apply a function across multiple columns\n\n-   Like `group_by()`, this function is often paired with another transformation function\n\n::: heq\nI want all my integer values to have two significant figures.\n:::\n\n \n\n```{r}\ndds.discr6 = dds.discr2 %>%\n  mutate(across(where(is.integer), signif, digits = 2))\n\nglimpse(dds.discr6)\n```\n\n# Folder organization\n\n## Folder organization\n\n-   Make a folder for our class!\n    -   I suggest naming it something like `BSTA_512_W25` to indicate the class and the term\n-   Make these folders in your computer (or in OneDrive if you prefer)\n\n    -   Only make them in OneDrive **if** you have a desktop connection\n\n::: columns\n::: column\n-   For a project, I have the following folders\n\n    -   Background\n    -   Code\n    -   Data_Raw\n    -   Data_Processed\n    -   Dissemination\n    -   Reports\n    -   Meetings\n:::\n\n::: column\n-   For our class, I suggest making one folder for the course with the following folders in it:\n\n    -   Data\n    -   Homework\n    -   Project (with above subfolders)\n    -   Lessons\n    -   And other folders if you want\n:::\n:::\n\n## Aside: folder and file naming\n\nThere are a few good practices for naming files and folders for easy tracking:\n\n1. Keep the name short and relevant\n2. Use leading numbers to help organize sequential items\n    - I can show you my lessons folders as an example \n3. Use dates in the format \"YYYY-MM-DD\" so that files are in chronological order\n4. You can label different versions if you would like to \n5. Use \"_\" to separate sections of the name\n    - I also use this to separate words, but some people say you should use \"-\" to separate words\n    \n## Creating project in RStudio\n\n-   Way to designate a working directory: basically your home base when working in R\n\n    -   We have to tell R exactly where we are in our folders and where to find other things\n\n    -   A project makes it easier to tell R where we are\n\n-   Basic steps to create a project\n\n    -   Go into RStudio\n\n    -   Create new project for this class (under `File` or top right corner)\n        \n        - I would chose \"Existing Directory\" since we have already set up our folders\n        - Make the new project in the `BSTA_512_W25` folder\n\n-   Once we have projects, we can open one and R will automatically know that its location is the start of our working directory\n\n- Only make one project for now!! \n\n## The nice thing about R projects\n\n- 5 minute video explaining some of the nice features of R projects\n\n<https://rfortherestofus.com/2022/10/rstudio-projects>\n\n\n## Reproducibility\n\n- Research data and code can reach the same results regardless of who is running the code\n\n  - This can also refer to future or past you!\n\n \n\n- We want to set up our work so the entire folder can be moved around and work in its new location\n\n \n\n- Projects work well in combination with the `here` package\n\n# `here` package and importing data\n\n## `here` package\n\n![Illustration by [Allison Horst](https://github.com/allisonhorst)](../img_slides/here_pkg.png)\n\n## `here` package\n\n::::: columns\n::: column\n-   [Good source for the `here` package](http://jenrichmond.rbind.io/post/how-to-use-the-here-package/)\n\n    -   Just substitute `.Rmd` with `.qmd`\n\n-   Basically, a `.qmd` file and `.R` file work differently\n\n    -   We haven't worked much with `.R` files\n\n-   For `.qmd` files, the automatic directory is the folder it is in\n\n    -   But we want it to be the main project folder\n\n-   `here` can help with that\n\n \n\n-   **Very important for reproducibility!!**\n:::\n\n::: column\n![](../img_slides/paths.png){fig-align=\"center\"}\n:::\n:::::\n\n## Using `here` package\n\n-   Within your console, type `here()` and enter\n\n    -   Try this with `getwd()` as well\n\n```{r}\nlibrary(here)\nhere()\ngetwd()\n```\n\n \n\n-   `here` can be used whenever we need to access a file path in **R code**\n    -   Importing data\n    -   Saving output\n    -   Accessing files\n\n# Importing data\n\n## Using `here()` to load data\n\n-   The `here()` function will start at the working directory (where your `.Rproj` file is) and let you write out a file path for anything\n\n-   To load the dataset in our `.qmd` file, we will use:\n\n```{r}\n#| eval: false\nlibrary(readxl)\ndata = read_excel(here(\"./data/BodyTemperatures.xlsx\"))\ndata = read_excel(here(\"data\", \"BodyTemperatures.xlsx\"))\n```\n\n\n## Common functions to load data\n\n| Function       | Data file type  | Package needed |\n|----------------|-----------------|----------------|\n| `read_excel()` | `.xls`, `.xlsx` | `readxl`       |\n| `read.csv()`   | `.csv`          | Built in       |\n| `load()`       | `.Rdata`        | Built in       |\n| `read_sas()`   | `.sas7bdat`     | `haven`        |\n\n\n# Resources\n\n## `dplyr` resources\n\n-   [More `dpylr` functions to reference!](https://dplyr.tidyverse.org/reference/index.html)\n\nAdditional details and examples are available in the vignettes:\n\n-   [column-wise operations vignette](https://dplyr.tidyverse.org/articles/colwise.html)\n\n-   [row-wise operations vignette](https://dplyr.tidyverse.org/articles/rowwise.html)\n\n \n\nand the dplyr 1.0.0 release blog posts:\n\n-   [working across columns](https://www.tidyverse.org/blog/2020/04/dplyr-1-0-0-colwise/)\n-   [working within rows](https://www.tidyverse.org/blog/2020/04/dplyr-1-0-0-rowwise/)\n\n## R programming class at OHSU!\n\nYou can check out [Dr. Jessica Minnier's R class page](https://sph-r-programming-2022.netlify.app/) if you want more notes, videos, etc.\n\n## The larger tidy ecosystem\n\nJust to name a few...\n\n-   [janitor](https://garthtarr.github.io/meatR/janitor.html)\n\n-   [kableExtra](https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html)\n\n-   [patchwork](https://patchwork.data-imaginist.com/)\n\n-   [gghighlight](https://cran.r-project.org/web/packages/gghighlight/vignettes/gghighlight.html)\n\n-   [tidybayes](https://mjskay.github.io/tidybayes/)\n\n## Credit to Mine Çetinkaya-Rundel\n\n-   These notes were built from Mine's notes\n\n    -   Most pages and code were left as she made them\n\n    -   I changed a few things to match our class\n\n-   Please see [her Github repository](https://github.com/mine-cetinkaya-rundel/teach-ds-wsc-2021/tree/main) for the original notes\n","srcMarkdownNoYaml":"\n\n```{r setup, include = FALSE}\n# R options\noptions(htmltools.dir.version = FALSE)\n\n# figure height, width, dpi\nknitr::opts_chunk$set(echo = TRUE, \n                      fig.width = 5, \n                      fig.height = 3,\n                      dpi = 300)\n\n# fontawesome\nhtmltools::tagList(rmarkdown::html_dependency_font_awesome())\n\n# magick\ndev.off <- function(){\n  invisible(grDevices::dev.off())\n}\n\n# set seed\nset.seed(1234)\n\n# packages\nlibrary(countdown)\nlibrary(tidyverse)\nlibrary(broom)\nlibrary(scales)\nlibrary(openintro)\nlibrary(jsonlite)\nlibrary(here)\n```\n\n## Need to include slides on working with and storing datasets\n\n- Raw/original\n- Processed/cleaned\n  - cleaned, handled missing values, transformed (pivoted), formatted properly, applying specific variable types from codebook\n- Feature engineered data\n  - creating new features or modifying existing ones\n\n# What we will cover\n\n1. Introduction to `tidyverse`\n2. `ggplot2` revisited\n2. Functions for data management\n3. Functions for data summarization\n4. Folder organization\n5. `here` package and importing data\n\n \n\n- Not covered: basic Quarto set up. Please see R recordings in OneDrive and my [EPI 525 site](https://nwakim.github.io/F24_EPI_525/schedule.html) for videos and slides.\n\n```{css, echo=FALSE}\n.reveal code {\n  max-height: 100% !important;\n}\n```\n\n## \n\n![Artwork by \\@allison_horst](../img_slides/debugging.png){fig-alt=\"A cartoon of a fuzzy round monster face showing 10 different emotions experienced during the process of debugging code. The progression goes from (1) “I got this” - looking determined and optimistic; (2) “Huh. Really thought that was it.” - looking a bit baffled; (3) “...” - looking up at the ceiling in thought; (4) “Fine. Restarting.” - looking a bit annoyed; (5) “OH WTF.” Looking very frazzled and frustrated; (6) “Zombie meltdown.” - looking like a full meltdown; (7) (blank) - sleeping; (8) “A NEW HOPE!” - a happy looking monster with a lightbulb above; (9) “insert awesome theme song” - looking determined and typing away; (10) “I love coding” - arms raised in victory with a big smile, with confetti falling.\"}\n\n# Introduction to the `tidyverse`\n\n## \n\n![](../img_slides/spiderverse.jpeg){fig-align=\"center\"}\n\n## What is the tidyverse?\n\nThe **tidyverse** is a collection of R packages designed for data science. All packages share an underlying design philosophy, grammar, and data structures.\n\n::: columns\n::: {.column width=\"45%\"}\n-   **ggplot2** - data visualisation\n-   **dplyr** - data manipulation\n-   **tidyr** - tidy data\n-   **readr** - read rectangular data\n-   **purrr** - functional programming\n-   **tibble** - modern data frames\n-   **stringr** - string manipulation\n-   **forcats** - factors\n-   and many more ...\n:::\n\n::: {.column width=\"55%\"}\n![](../img_slides/tidyverse.png){fig-align=\"center\" width=\"669\"}\n:::\n:::\n\n## Tidy data[^1]\n\n[^1]: Source: R for Data Science. Grolemund and Wickham.\n\n![](../img_slides/tidy-data-frame.png){fig-align=\"center\" width=\"1500\"}\n\n\n1.  Each variable must have its own column.\n\n2.  Each observation must have its own row.\n\n3.  Each value must have its own cell.\n\n## Pipe operator (`magrittr`)\n\n-   The pipe operator (`%>%`) allows us to step through sequential functions in the same way we follow if-then statements or steps from instructions\n\n \n\n::: heq\nI want to find my keys, then start my car, then drive to work, then park my car.\n:::\n\n \n\n::: columns\n::: {.column width=\"50%\"}\n**Nested**\n\n```{r eval = FALSE}\npark(drive(start_car(find(\"keys\")), \n           to = \"work\"))\n```\n:::\n\n::: {.column width=\"50%\"}\n**Piped**\n\n```{r eval = FALSE}\nfind(\"keys\") %>%\n  start_car() %>%\n  drive(to = \"work\") %>%\n  park()\n```\n:::\n:::\n\n## Recoding a binary variable with pipe operator\n\n \n\n::: heq\nLet's say I want a variable `transmission` to show the category names that are assigned to numeric values in the code. I want `0` to be coded as `automatic` and `1` to be coded as `manual`.\n:::\n\n \n\n::: columns\n::: {.column width=\"50%\"}\nBase R:\n\n```{r}\nmtcars$transmission <-\n  ifelse(\n    mtcars$am == 0,\n    \"automatic\",\n    \"manual\"\n  )\n```\n:::\n\n::: {.column width=\"50%\"}\nTidyverse:\n\n```{r}\nmtcars <- mtcars %>%\n  mutate(\n    transmission = case_when(\n      am == 0 ~ \"automatic\",\n      am == 1 ~ \"manual\"\n    )\n  )\n```\n\n \n\n::: hl\n`mutate()` creates new columns that are functions of existing variables\n:::\n:::\n:::\n\n## Recoding a multi-level variable\n\n \n\n::: heq\nLet's say I want a variable `gear` to show the category names that are assigned to numeric values in the code. I want `3` to be coded as gear `three`, `4` to be coded as gear `four`, `5` to be coded as gear `five`.\n:::\n\n \n\n::: columns\n::: {.column width=\"50%\"}\nBase R:\n\n```{r}\nmtcars$gear_char <-\n  ifelse(\n    mtcars$gear == 3,\n    \"three\",\n    ifelse(\n      mtcars$gear == 4,\n      \"four\",\n      \"five\"\n    )\n  )\n```\n:::\n\n::: {.column width=\"50%\"}\nTidyverse:\n\n```{r}\nmtcars <- mtcars %>%\n  mutate(\n    gear_char = case_when(\n      gear == 3 ~ \"three\",\n      gear == 4 ~ \"four\",\n      gear == 5 ~ \"five\"\n    )\n  )\n```\n:::\n:::\n\n# `ggplot2` revisited\n\n## `ggplot2` in tidyverse\n\n::: columns\n::: {.column width=\"50%\"}\n![](../img_slides/ggplot2-part-of-tidyverse.png){fig-align=\"center\" width=\"669\"}\n\n:::\n\n::: {.column width=\"50%\"}\n-   We talked about this in our review notes\n\n    -   I want to revisit it: always helps to have more examples!\n    -   This example is closer to the multivariable work we'll do in this class!\n\n \n\n-   **ggplot2** is tidyverse's data visualization package\n\n \n\n-   The `gg` in \"ggplot2\" stands for Grammar of Graphics\n\n \n\n-   It is inspired by the book **Grammar of Graphics** by Leland Wilkinson\n:::\n:::\n\n## Tidyverse: Visualizing multiple variables\n\n \n\n```{r out.width = \"100%\", fig.asp = 0.3, fig.width = 8}\nggplot(\n  mtcars,\n  aes(x = disp, y = mpg, color = transmission)) +\n  geom_point()\n```\n\n## Tidyverse: Visualizing even more variables\n\n```{r out.width = \"100%\", fig.asp = 0.3, fig.width = 8}\nggplot(\n  mtcars,\n  aes(x = disp, y = mpg, color = transmission)) +\n  geom_point() +\n  facet_wrap(~ cyl)\n```\n\n## Base R: Visualizing even more variables\n\n```{r out.width = \"100%\", fig.asp = 0.3, fig.width = 8}\nmtcars$trans_color <- ifelse(mtcars$transmission == \"automatic\", \"green\", \"blue\")\nmtcars_cyl4 = mtcars[mtcars$cyl == 4, ]\nmtcars_cyl6 = mtcars[mtcars$cyl == 6, ]\nmtcars_cyl8 = mtcars[mtcars$cyl == 8, ]\npar(mfrow = c(1, 3), mar = c(2.5, 2.5, 2, 0), mgp = c(1.5, 0.5, 0))\nplot(mpg ~ disp, data = mtcars_cyl4, col = trans_color, main = \"Cyl 4\")\nplot(mpg ~ disp, data = mtcars_cyl6, col = trans_color, main = \"Cyl 6\")\nplot(mpg ~ disp, data = mtcars_cyl8, col = trans_color, main = \"Cyl 8\")\nlegend(\"topright\", legend = c(\"automatic\", \"manual\"), pch = 1, col = c(\"green\", \"blue\"))\n```\n\n# Functions for data management\n\n## Important functions for data management\n\n \n\n**Data manipulation**\n\n-   `pivot_longer()` and `pivot_wider()` (not covered today)\n\n-   `rename()`\n\n-   `mutate()`\n\n-   `filter()`\n\n-   `select()`\n\n**Summarizing data**\n\n-   `tbl_summary()`\n-   `group_by()`\n-   `summarize()`\n-   `across()`\n\n## Let's look back at the `dds.discr` dataset that I briefly used last class\n\n   \n\n-   We will load the data (This is a special case! `dds.discr` is a built-in R dataset)\n\n```{r}\ndata(\"dds.discr\")\n```\n\n-   Now, let's take a glimpse at the dataset:\n\n```{r}\nglimpse(dds.discr)\n```\n\n## `rename()`: one of the first things I usually do\n\n-   I notice that two variables have values that don't necessarily match the variable name\n\n    -   Female and male are not genders\n\n    -   \"White not Hispanic\" combines race and ethnicity into one category\n\n::: heq\nI want to rename gender to SAB (sex assigned at birth) and rename ethnicity to R_E (race and ethnicity)\n:::\n\n \n\n```{r}\ndds.discr1 = dds.discr %>% \n  rename(SAB = gender, \n         R_E = ethnicity)\n\nglimpse(dds.discr1)\n```\n\n## `mutate()`: constructing new variables from what you have\n\n-   We've seen a couple examples for `mutate()` so far (mostly because its used so often!)\n\n-   We haven't seen an example where we make a new variable from two variables\n\n::: heq\nI want to make a variable that is the ratio of expenditures over age\n:::\n\n \n\n```{r}\ndds.discr2 = dds.discr1 %>%\n  mutate(exp_to_age = expenditures/age)\n\nglimpse(dds.discr2)\n```\n\n## `mutate()`: other examples\n\n```{r}\ndds.discr3 = dds.discr1 %>%\n  mutate(expend_20perc = expenditures * 0.2, \n         expend_sq = expenditures^2, \n         expend_over_5000 = case_when(\n           expenditures > 5000 ~ \"Yes\", \n           expenditures <= 5000 ~ \"No\"\n         ), \n         expend_log = log(expenditures)\n  )\nglimpse(dds.discr3)\n```\n\n## `filter()`: keep rows that match a condition\n\n-   What if I want to subset the data frame? (keep certain rows of observations)\n\n::: heq\nI want to look at the data for people who between 50 and 60 years old\n:::\n\n \n\n```{r}\ndds.discr3 = dds.discr2 %>%\n  filter(age >= 50 & age <= 60)\n\nglimpse(dds.discr3)\n```\n\n## `select()`: keep or drop columns using their names and types\n\n-   What if I want to remove or keep certain variables?\n\n::: heq\nI want to only have age and expenditure in my data frame\n:::\n\n \n\n```{r}\ndds.discr4 = dds.discr2 %>%\n  select(age, expenditures)\n\nglimpse(dds.discr4)\n```\n\n# Summarizing Data\n\n## `tbl_summary()` : table summary (1/2)\n\n-   What if I want one of those fancy summary tables that are at the top of most research articles? (lovingly called \"Table 1\")\n\n::: columns\n::: {.column width=\"50%\"}\n```{r}\n#| eval: false\n\nlibrary(gtsummary)\ntbl_summary(dds.discr2)\n```\n:::\n\n::: {.column width=\"50%\"}\n```{r}\n#| echo: false\n\nlibrary(gtsummary)\ntbl_summary(dds.discr2)\n```\n:::\n:::\n\n## `tbl_summary()` : table summary (2/2)\n\n-   Let's make this more presentable\n\n \n\n::: columns\n::: {.column width=\"70%\"}\n```{r}\n#| eval: false\n\ndds.discr2 %>%\n  select(-id, -age.cohort, -exp_to_age) %>%\n  tbl_summary(label = c(age ~ \"Age\", \n                        R_E ~ \"Race/Ethnicity\", \n                        SAB ~ \"Sex Assigned at Birth\", \n                        expenditures ~ \"Expenditures\") ,\n              statistic = list(all_continuous() ~ \"{mean} ({sd})\"))\n```\n:::\n\n::: {.column width=\"30%\"}\n```{r}\n#| echo: false\n\ndds.discr2 %>%\n  select(-id, -age.cohort, -exp_to_age) %>%\n  tbl_summary(label = c(age ~ \"Age\", \n                        R_E ~ \"Race/Ethnicity\", \n                        SAB ~ \"Sex Assigned at Birth\", \n                        expenditures ~ \"Expenditures\") ,\n              statistic = list(all_continuous() ~ \"{mean} ({sd})\"))\n```\n:::\n:::\n\n## `group_by()`: group by one or more variables\n\n-   What if I want to quickly look at group differences?\n-   It will not change how the data look, but changes the actions of following functions\n\n::: heq\nI want to group my data by sex assigned at birth.\n:::\n\n \n\n```{r}\ndds.discr5 = dds.discr2 %>%\n  group_by(SAB)\nglimpse(dds.discr5)\n```\n\n-   Let's see how the groups change something like the `summarize()` function in the next slide\n\n## `summarize()`: summarize your data or grouped data into one row\n\n-   What if I want to calculate specific descriptive statistics for my variables?\n-   This function is often best used with `group_by()`\n-   If only presenting the summaries, functions like `tbl_summary()` is better\n-   `summarize()` creates a new data frame, which means you can plot and manipulate the summarized data\n\n \n\n::: columns\n::: column\nOver whole sample:\n\n```{r}\ndds.discr2 %>% \n  summarize(\n    ave = mean(expenditures),\n    SD = sd(expenditures),\n    med = median(expenditures))\n```\n:::\n\n::: column\nGrouped by sex assigned at birth:\n\n```{r}\ndds.discr2 %>% \n  group_by(SAB) %>% \n  summarize(\n    ave = mean(expenditures),\n    SD = sd(expenditures),\n    med = median(expenditures))\n```\n:::\n:::\n\n## `across()`: apply a function across multiple columns\n\n-   Like `group_by()`, this function is often paired with another transformation function\n\n::: heq\nI want all my integer values to have two significant figures.\n:::\n\n \n\n```{r}\ndds.discr6 = dds.discr2 %>%\n  mutate(across(where(is.integer), signif, digits = 2))\n\nglimpse(dds.discr6)\n```\n\n# Folder organization\n\n## Folder organization\n\n-   Make a folder for our class!\n    -   I suggest naming it something like `BSTA_512_W25` to indicate the class and the term\n-   Make these folders in your computer (or in OneDrive if you prefer)\n\n    -   Only make them in OneDrive **if** you have a desktop connection\n\n::: columns\n::: column\n-   For a project, I have the following folders\n\n    -   Background\n    -   Code\n    -   Data_Raw\n    -   Data_Processed\n    -   Dissemination\n    -   Reports\n    -   Meetings\n:::\n\n::: column\n-   For our class, I suggest making one folder for the course with the following folders in it:\n\n    -   Data\n    -   Homework\n    -   Project (with above subfolders)\n    -   Lessons\n    -   And other folders if you want\n:::\n:::\n\n## Aside: folder and file naming\n\nThere are a few good practices for naming files and folders for easy tracking:\n\n1. Keep the name short and relevant\n2. Use leading numbers to help organize sequential items\n    - I can show you my lessons folders as an example \n3. Use dates in the format \"YYYY-MM-DD\" so that files are in chronological order\n4. You can label different versions if you would like to \n5. Use \"_\" to separate sections of the name\n    - I also use this to separate words, but some people say you should use \"-\" to separate words\n    \n## Creating project in RStudio\n\n-   Way to designate a working directory: basically your home base when working in R\n\n    -   We have to tell R exactly where we are in our folders and where to find other things\n\n    -   A project makes it easier to tell R where we are\n\n-   Basic steps to create a project\n\n    -   Go into RStudio\n\n    -   Create new project for this class (under `File` or top right corner)\n        \n        - I would chose \"Existing Directory\" since we have already set up our folders\n        - Make the new project in the `BSTA_512_W25` folder\n\n-   Once we have projects, we can open one and R will automatically know that its location is the start of our working directory\n\n- Only make one project for now!! \n\n## The nice thing about R projects\n\n- 5 minute video explaining some of the nice features of R projects\n\n<https://rfortherestofus.com/2022/10/rstudio-projects>\n\n\n## Reproducibility\n\n- Research data and code can reach the same results regardless of who is running the code\n\n  - This can also refer to future or past you!\n\n \n\n- We want to set up our work so the entire folder can be moved around and work in its new location\n\n \n\n- Projects work well in combination with the `here` package\n\n# `here` package and importing data\n\n## `here` package\n\n![Illustration by [Allison Horst](https://github.com/allisonhorst)](../img_slides/here_pkg.png)\n\n## `here` package\n\n::::: columns\n::: column\n-   [Good source for the `here` package](http://jenrichmond.rbind.io/post/how-to-use-the-here-package/)\n\n    -   Just substitute `.Rmd` with `.qmd`\n\n-   Basically, a `.qmd` file and `.R` file work differently\n\n    -   We haven't worked much with `.R` files\n\n-   For `.qmd` files, the automatic directory is the folder it is in\n\n    -   But we want it to be the main project folder\n\n-   `here` can help with that\n\n \n\n-   **Very important for reproducibility!!**\n:::\n\n::: column\n![](../img_slides/paths.png){fig-align=\"center\"}\n:::\n:::::\n\n## Using `here` package\n\n-   Within your console, type `here()` and enter\n\n    -   Try this with `getwd()` as well\n\n```{r}\nlibrary(here)\nhere()\ngetwd()\n```\n\n \n\n-   `here` can be used whenever we need to access a file path in **R code**\n    -   Importing data\n    -   Saving output\n    -   Accessing files\n\n# Importing data\n\n## Using `here()` to load data\n\n-   The `here()` function will start at the working directory (where your `.Rproj` file is) and let you write out a file path for anything\n\n-   To load the dataset in our `.qmd` file, we will use:\n\n```{r}\n#| eval: false\nlibrary(readxl)\ndata = read_excel(here(\"./data/BodyTemperatures.xlsx\"))\ndata = read_excel(here(\"data\", \"BodyTemperatures.xlsx\"))\n```\n\n\n## Common functions to load data\n\n| Function       | Data file type  | Package needed |\n|----------------|-----------------|----------------|\n| `read_excel()` | `.xls`, `.xlsx` | `readxl`       |\n| `read.csv()`   | `.csv`          | Built in       |\n| `load()`       | `.Rdata`        | Built in       |\n| `read_sas()`   | `.sas7bdat`     | `haven`        |\n\n\n# Resources\n\n## `dplyr` resources\n\n-   [More `dpylr` functions to reference!](https://dplyr.tidyverse.org/reference/index.html)\n\nAdditional details and examples are available in the vignettes:\n\n-   [column-wise operations vignette](https://dplyr.tidyverse.org/articles/colwise.html)\n\n-   [row-wise operations vignette](https://dplyr.tidyverse.org/articles/rowwise.html)\n\n \n\nand the dplyr 1.0.0 release blog posts:\n\n-   [working across columns](https://www.tidyverse.org/blog/2020/04/dplyr-1-0-0-colwise/)\n-   [working within rows](https://www.tidyverse.org/blog/2020/04/dplyr-1-0-0-rowwise/)\n\n## R programming class at OHSU!\n\nYou can check out [Dr. Jessica Minnier's R class page](https://sph-r-programming-2022.netlify.app/) if you want more notes, videos, etc.\n\n## The larger tidy ecosystem\n\nJust to name a few...\n\n-   [janitor](https://garthtarr.github.io/meatR/janitor.html)\n\n-   [kableExtra](https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html)\n\n-   [patchwork](https://patchwork.data-imaginist.com/)\n\n-   [gghighlight](https://cran.r-project.org/web/packages/gghighlight/vignettes/gghighlight.html)\n\n-   [tidybayes](https://mjskay.github.io/tidybayes/)\n\n## Credit to Mine Çetinkaya-Rundel\n\n-   These notes were built from Mine's notes\n\n    -   Most pages and code were left as she made them\n\n    -   I changed a few things to match our class\n\n-   Please see [her Github repository](https://github.com/mine-cetinkaya-rundel/teach-ds-wsc-2021/tree/main) for the original notes\n"},"formats":{"revealjs":{"identifier":{"display-name":"RevealJS","target-format":"revealjs","base-format":"revealjs"},"execute":{"fig-width":10,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":false,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":true,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","html-math-method":{"method":"mathjax","url":"https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js?config=TeX-AMS_HTML-full"},"slide-level":2,"to":"revealjs","highlight-style":"ayu","output-file":"02_Data_Management.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":false,"quarto-version":"1.8.25","auto-stretch":true,"title":"Lesson 2: Data and File Management","subtitle":"Adapted from parts of Mine Çetinkaya-Rundel's tidyverse course","author":"Nicky Wakim","title-slide-attributes":{"data-background-color":"#213c96"},"date":"`r library(here); source(here('class_dates.R')); w1d2`","theme":"../simple_NW.scss","chalkboard":true,"slideNumber":true,"showSlideNumber":"all","width":1955,"height":1100,"footer":"Lesson 2: Data Management"}}},"projectFormats":["html"]}